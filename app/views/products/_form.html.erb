<%= error_messages_for :record %>
<% row_id = "record_#{@record.id ? @record.id : 'new'}" %>
<% remote_form_for :record, :url => url, :html => {:onsubmit => "jQuery(this).update_textareas();",  :id => "product_form_" + row_id} do |f| %>
<div class="tabs">
  <ul>
    <li><a href="#<%= row_id %>_tab_product"><%= t(:model_product) %></a></li>
    <li><a href="#<%= row_id %>_tab_product_category"><%= t(:attr_category) %></a></li>
    <li><a href="#<%= row_id %>_tab_picture"><%= t(:attr_picture) %></a></li>
  </ul>
  <div id="<%= row_id %>_tab_product">
    <p><label for="<%=row_id%>_name"><%= t(:attr_name) %></label><br />
    <%= f.text_field :name, :id=>"#{row_id}_name", :class => '{required: true, minlength: 2, maxlength: 100}' %></p>
    <p><label for="<%=row_id%>_price"><%= t(:attr_price) %></label><br />
    <%= f.text_field :price, :id=>"#{row_id}_price", :class => '{required: true, number: true, minlength: 1}' %></p>
    <p><label for="<%=row_id%>_cost"><%= t(:cost) %></label><br />
    <%= f.text_field :cost, :id=>"#{row_id}_cost", :class => '{required: true, number: true, minlength: 1}' %></p>
    <p><label for="<%=row_id%>_disabled"><%= t(:disabled) %></label><br />
    <%= f.check_box :disabled, :id=>"#{row_id}_disabled" %></p>
    <p><label for="<%=row_id%>_term_of_delivery"><%= t(:term_of_delivery) %></label><br />
    <%= f.hidden_field :term_of_delivery, :id=>"#{row_id}_term_of_delivery"%></p>
    <p><%= t(:num_of_days).mb_chars.capitalize%>: <span id="<%=row_id%>_num_of_days"/></p>
    <div id="<%=row_id%>_term_of_delivery_slider"/>
    <p><label for="<%= row_id %>_short_description"><%= t("attr_short_description") %></label><br />
    <%= f.text_area :short_description, :class => 'small_area {required: true, maxlength: 250}', :id => "#{row_id}_short_description" %></p>
    <p><label for="<%= row_id %>_description"><%= t("attr_description") %></label>
    <%= f.text_area :description, :class => 'small_area', :id => "#{row_id}_description" %></p>
  </div>
  <div id="<%= row_id %>_tab_product_category">
    <p><label><%=t(:attr_category)%></label></p>
    <%= render :partial => "categories", :locals => {:row_id => row_id, :categories => @product_categories, :js => "choose_category"}%>
  </div>
  <div id="<%= row_id %>_tab_picture">
    <% if @record.image_flag %>
    <div class="picture">
      <img src="/pictures/item_<%= @record.item_id %>.th.jpg" alt="<%= @record.name %>" />
      <p><label for="<%= row_id %>_image_flag"><%= t(:show_picture) %>
      <%= f.check_box :image_flag, :id => "#{row_id}_image_flag" %></p>
    </div>
    <% end %>
    <p class="uploader"><label for="<%= row_id %>_record_picture"><%= t('upload_new_picture') %></label><br />
    <input type="file" name="image_file" id="<%= row_id %>_record_picture" /></p>  
  </div>
<p><%= yield(:submit_button) || '<input type="submit" value="' + t(:submit) + '" />' %></p>
</div>
<% end %>
<script type="text/javascript">
<% @record.categorized_products.each do |cp| %>
choose_category('<%=row_id%>',<%=cp.product_category_id%>);
<%end%>
$("form").initValidation();

var row_color = $('#record_<%= @record.id %>').hasClass('even') ? 'D7DEBB' : 'f0f2e0';
$('.uploader').jqUploader({
  src: "/javascripts/flash_upload/jqUploader.swf",
  uploadScript: "<%= url_for(:controller=>:images,:action=>:create)%>",
  postData: jQuery.param({_zelena_kuchyne_session: jQuery.cookie("_zelena_kuchyne_session") }),
  allowedExtDescr: "Images (*.jpg; *.jpeg)",
  allowedExt: "jpg|JPG",
  background: row_color,
  endMessage: "<%= t('picture_uploaded') %>",
  validFileMessage: "<%= t('picture_valid') %>",
  progressMessage: "<%= t('picture_being_uploaded') %>",
  hideSubmit: false
});
$(function() {
  var value = parseInt($("#<%=row_id%>_term_of_delivery").val().replace(/[^0-9]/,""));
  var update_elements  = function(val) {
    if(val < 0 || isNaN(val)) {
      $("#<%=row_id%>_num_of_days").html(<%=t(:unknown).inspect%>);
      $("#<%=row_id%>_term_of_delivery").val("");
    } else {
      $("#<%=row_id%>_num_of_days").html("" + val);
      $("#<%=row_id%>_term_of_delivery").val(val + " days");
    }
  }
  $("#<%=row_id%>_term_of_delivery_slider").slider({
    startValue: (isNaN(value))? -1 : value,
    min: -1,
    max: 30,
    slide: function(event, ui) {
      update_elements(ui.value);
    }
  });
  update_elements($("#<%=row_id%>_term_of_delivery_slider").slider("value"));
});
</script>